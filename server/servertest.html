<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Game Server Testing</title>
    <script src="http://code.jquery.com/jquery.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <style>
        body {
            margin: 7px;
        }
        table {
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h2>Game Server Testing</h2>

    <table class="table table-condensed table-striped">
        <tbody id="logtable"></tbody>
    </table>

</body>
</html>

<script src="http://localhost:8080/socket.io/socket.io.js"></script>

<script>


//////////////////////////////
// Modules and Variables    //
//////////////////////////////

var socket = io.connect('http://localhost:8080');
var room = false;


//////////////////////////////
// Communication Events     //
//////////////////////////////

socket.on('connected', function (success) {
    if (success === true) {
        log('Successful Connected');
    }
});

socket.on('room_pin', function (pin) {
    if (pin) {
        room = pin;
        log('Joined Room #' + pin);
    } else {
        log('Could not join room, maybe it is full.');
    }
});

socket.on('new_room_pin', function (pin) {
    log('New PIN received: ' + pin);
    joinRoom(pin);
});

socket.on('no_match_found', function () {
    log('No Match found.');
    newRoom();
});

socket.on('game_data', function (data) {
    log('Game Data received');
    console.dir(data);
});

socket.on('get_rooms', function (data) {
    $.each(data, function(index, value) {
        if (index != "") {
            log('Room #' + index + ', Users: ' + value);
        }
    });
});


//////////////////////////////
// Communication Functions  //
//////////////////////////////

function findMatch() {
    log('>> findMatch()');
    socket.emit('find_match');
}

function newRoom() {
    log('>> newRoom()');
    socket.emit('new_room');
}

function joinRoom(pin) {
    log('>> joinRoom(' + pin + ')');
    socket.emit('join_room', pin);
}

function leaveRoom() {
    log('>> leaveRoom()');
    socket.emit('leave_room');
}

function broadcast(game_data) {
    if (room) {
        log('>> broadcast()');
        socket.emit('broadcast', game_data);
    } else {
        log('Not in a room yet!')
    }
}

function getRooms() {
    console.log('>> getRooms()');
    socket.emit('get_rooms', '');
}


//////////////////////////////
// Helper Functions         //
//////////////////////////////

function log(msg) {

    var date = new Date();
    var hour = date.getHours().pad(2);
    var minute = date.getMinutes().pad(2);
    var second = date.getSeconds().pad(2);

    var html = '<tr><td width="54px">' + hour + ':' + minute + ':' + second + '</td><td>' + msg + '</td></tr>';
    $('#logtable').append(html);
}

// http://stackoverflow.com/questions/3313875/javascript-date-ensure-getminutes-gethours-getseconds-puts-0-in-front-i
Number.prototype.pad = function (len) {
    return (new Array(len+1).join("0") + this).slice(-len);
}

</script>
